import pickle
import os
import re
import sys

import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn import metrics



modelname = 'Constants\dynamic.jd'
loaded_model = pickle.load(open(modelname, 'rb'))

# Import Benign Feature list
benign_features = np.array(pd.read_csv('Features\\benign.csv'))
y_benign = benign_features[:, [0]]
X_benign = np.delete(benign_features, 0, axis=1)

# Import Malware Feature list
malware_features = np.array(pd.read_csv('Features\\malware.csv'))
y_malware = malware_features[:, [0]]
X_malware = np.delete(malware_features, 0, axis=1)

# Merge benign and malware feature list representation
X = np.concatenate((X_benign, X_malware))
y = np.concatenate((y_benign, y_malware))[:, 0]

top_n = 200
X = X[:, 0:top_n]

# Split data into train/test
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.25)

y_pred = loaded_model.predict(X_test)

accuracy = metrics.accuracy_score(y_test, y_pred)
precision = metrics.precision_score(y_test, y_pred)
recall = metrics.recall_score(y_test, y_pred)
score = metrics.f1_score(y_test, y_pred)

print("Accuracy:", accuracy)
print("Precision:", precision)
print("Recall:", recall)
print("Score:", score)

'''
Accuracy: 0.98984375
Precision: 0.9968178202068417
Recall: 0.9827450980392157
Score: 0.9897314375987363
'''
